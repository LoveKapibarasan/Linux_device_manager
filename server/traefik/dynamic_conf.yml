http:
  routers:
    webdav-router:
      rule: "Host(`webdav.lovekapibarasan.org`)"
      entryPoints: [ "websecure" ]
      service: webdav-service
      tls:
        certResolver: le

    search-router:
      rule: "Host(`search.lovekapibarasan.org`)"
      entryPoints: ["websecure"]
      service: search-service
      tls:
        certResolver: le

    pihole-router:
      rule: "Host(`pihole.lovekapibarasan.org`)"
      entryPoints: ["websecure"]
      service: pihole-service
      tls:
        certResolver: le    

    password-router:
      rule: "Host(`password.lovekapibarasan.org`)"
      entryPoints: ["websecure"]
      service: password-service
      tls:
        certResolver: le
    
    roundcube-router:
      rule: "Host(`roundcube.lovekapibarasan.org`)"
      entryPoints: ["websecure"]
      service: roundcube-service
      tls:
        certResolver: le

    expense-router:
      rule: "Host(`expense.lovekapibarasan.org`)"
      entryPoints: ["websecure"]
      service: expense-service
      tls:
        certResolver: le

    nextcloud-router:
      rule: "Host(`nextcloud.lovekapibarasan.org`)"
      entryPoints: [ "websecure" ]
      service: nextcloud-service
      middlewares:
        - "nextcloud-cors"
      tls:
        certResolver: le
    
    docker-router:
      rule: "Host(`docker.lovekapibarasan.org`)"
      entryPoints: ["websecure"]
      service: docker-service
      tls:
        certResolver: le

    memo-router:
      rule: "Host(`memo.lovekapibarasan.org`)"
      entryPoints: [ "websecure" ]
      service: memo-service
      tls:
        certResolver: le
    
    task-router:
      rule: "Host(`tasks.lovekapibarasan.org`)"
      entryPoints: ["websecure"]
      service: task-service
      tls:
        certResolver: le

    backup-router:
      rule: "Host(`backup.lovekapibarasan.org`)"
      entryPoints: [ "websecure" ]
      service: backup-service
      tls:
        certResolver: le

    backupui-router:
      rule: "Host(`backupui.lovekapibarasan.org`)"
      entryPoints: [ "websecure" ]
      service: backupui-service
      tls:
        certResolver: le

    anki-router:
      rule: "Host(`anki.lovekapibarasan.org`)"
      entryPoints: ["websecure"]
      service: anki-service
      tls:
        certResolver: le   

    loki-router:
      rule: "Host(`loki.lovekapibarasan.org`)"
      entryPoints: ["websecure"]
      service: loki-service
      middlewares:
        - "loki-auth"
      tls:
        certResolver: le     

    log-router:
      rule: "Host(`log.lovekapibarasan.org`)"
      entryPoints: ["websecure"]
      service: log-service
      tls:
        certResolver: le

    gitea-router:
      rule: "Host(`gitea.lovekapibarasan.org`)"
      entryPoints: ["websecure"]
      service: gitea-service
      tls:
        certResolver: le

    zot-router:
      rule: "Host(`zot.lovekapibarasan.org`)"
      entryPoints: ["websecure"]
      service: zot-service
      tls:
        certResolver: le

    minio-router:
      rule: "Host(`minio.lovekapibarasan.org`)"
      entryPoints: ["websecure"]
      service: minio-service
      tls:
        certResolver: le

    s3-router:
      rule: "Host(`s3.lovekapibarasan.org`)"
      entryPoints: [ "websecure" ]
      service: s3-service
      tls:
        certResolver: le

    mimir-router:
      rule: "Host(`mimir.lovekapibarasan.org`)"
      entryPoints: ["websecure"]
      service: mimir-service
      middlewares:
        - "mimir-auth"
      tls:
        certResolver: le

  services:
    webdav-service:
      loadBalancer:
        servers:
          - url: "http://10.10.0.2:2345"

    search-service:
      loadBalancer:
        servers:
          - url: "http://10.10.0.2:8081"
    
    pihole-service:
      loadBalancer:
        servers:
          - url: "http://10.10.0.2:8083"

    password-service:
      loadBalancer:
        servers:
          - url: "http://10.10.0.2:8085"
    
    roundcube-service:
      loadBalancer:
        servers:
          - url: "http://10.10.0.2:8088"

    nextcloud-service:
      loadBalancer:
        servers:
          - url: "http://10.10.0.2:8091"
    
    docker-service:
      loadBalancer:
        servers:
          - url: "http://10.10.0.2:8092"

    memo-service:
      loadBalancer:
        servers:
          - url: "http://10.10.0.2:8093"

    expense-service:
      loadBalancer:
        servers:
          - url: "http://10.10.0.2:8096"
    
    task-service:
      loadBalancer:
        servers:
          - url: "http://10.10.0.2:8097"

    backup-service:
      loadBalancer:
        servers:
          - url: "http://10.10.0.2:8099"

    backupui-service:
      loadBalancer:
        servers:
          - url: "http://10.10.0.2:8101"
    
    anki-service:
      loadBalancer:
        servers:
          - url: "http://10.10.0.2:9003"

    loki-service:
      loadBalancer:
        servers:
          - url: "http://10.10.0.7:3100"      

    log-service:
      loadBalancer:
        servers:
          - url: "http://10.10.0.7:8094"

    gitea-service:
      loadBalancer:
        servers:
          - url: "http://10.10.0.7:8102"

    zot-service:
      loadBalancer:
        servers:
          - url: "http://10.10.0.7:8103"
        responseForwarding:
          flushInterval: "900s"
    
    minio-service:
      loadBalancer:
        servers:
          - url: "http://10.10.0.7:9001"

    s3-service:
      loadBalancer:
        servers:
          - url: "http://10.10.0.7:9000"
    
    mimir-service:
      loadBalancer:
        servers:
          - url: "http://10.10.0.7:9009"

  middlewares:
    loki-auth:
      basicAuth:
        # htpasswd
        users:
          - "LOKI_BASIC_PASSWORD"
    mimir-auth:
      basicAuth:
        users:
          - "LOKI_BASIC_PASSWORD"
    nextcloud-cors:
      headers:
        # 許可するオリジン（Super Productivity URL）
        accessControlAllowOriginList:
          - "https://tasks.lovekapibarasan.org"
        # 許可するメソッド（WebDAVに必要なものを網羅）
        accessControlAllowMethods:
          - "GET"
          - "POST"
          - "PUT"
          - "DELETE"
          - "OPTIONS"
          - "PROPFIND"
          - "MKCOL"
          - "COPY"
          - "MOVE"
          - "LOCK"
          - "UNLOCK"
        # 許可するヘッダー
        accessControlAllowHeaders:
          - "Authorization"
          - "Content-Type"
          - "Depth"
          - "User-Agent"
          - "X-File-Size"
          - "X-Requested-With"
          - "If-Modified-Since"
          - "X-File-Name"
          - "Cache-Control"
        accessControlAllowCredentials: true
        accessControlMaxAge: 100
        addVaryHeader: true